<!-- Juice Project - Est. 2016 | Last updated 2026 -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <meta name="created" content="2016-03-14">
  <meta name="author" content="Juice Project">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="The Juice Box">
  <meta property="og:image" content="https://thejuicebox.live/og-image.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://thejuicebox.live/og-image.png">
  <meta property="og:title" content="Database Explorer">
  <meta property="og:description" content="Browse and explore all entries in The Juice Box database — organized by category, searchable, filterable.">
  <meta property="og:url" content="https://thejuicebox.live/graph.html">
  <meta name="twitter:title" content="Database Explorer">
  <meta name="twitter:description" content="Browse and explore all entries in The Juice Box database — organized by category, searchable, filterable.">
  <title>Database Explorer</title>

  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; color: #000; background: #f5f6fa; }
    nav { padding: 10px 20px; overflow-x: auto; -webkit-overflow-scrolling: touch; }
    nav ul { list-style: none; margin: 0; padding: 10px 15px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; align-items: center; }
    nav ul li { margin: 0; white-space: nowrap; }
    nav a { color: #0000EE !important; text-decoration: none; background: rgba(255,255,255,0.85); padding: 5px 12px; white-space: nowrap; border-radius: 6px; border: 1px solid rgba(0,0,255,0.3); box-shadow: 1px 1px 2px rgba(0,0,0,0.2); font-size: 0.82em; display: inline-block; line-height: 1.4; }
    nav select { padding: 6px 10px; border-radius: 6px; border: 1px solid rgba(0,0,255,0.3); font-size: 0.85em; background: rgba(255,255,255,0.85); }
    nav a { background: rgba(255,255,255,0.2) !important; backdrop-filter: blur(8px) !important; -webkit-backdrop-filter: blur(8px) !important; border: 1px solid rgba(255,255,255,0.3) !important; border-radius: 8px !important; }
    nav select { background: rgba(255,255,255,0.2) !important; backdrop-filter: blur(8px) !important; -webkit-backdrop-filter: blur(8px) !important; border: 1px solid rgba(255,255,255,0.3) !important; }

    .main { max-width: 1400px; margin: 0 auto; padding: 15px 20px; }

    .header-panel {
      background: rgba(255,255,255,0.9); border: 1px solid rgba(0,0,255,0.15); border-radius: 12px;
      padding: 20px 24px; margin-bottom: 18px;
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    }
    .header-panel h1 { margin: 0 0 6px 0; color: #0056b3; font-size: 1.6em; }
    .header-panel .subtitle { color: #555; margin: 0; font-size: 0.95em; }

    /* Filter bar */
    .filter-bar {
      display: flex; gap: 12px; flex-wrap: wrap; align-items: center;
      background: rgba(255,255,255,0.9); border: 1px solid rgba(0,0,255,0.12); border-radius: 10px;
      padding: 12px 16px; margin-bottom: 16px;
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 2px 12px rgba(0,0,0,0.04);
    }
    .filter-bar label { font-size: 0.78em; font-weight: 600; color: #0056b3; white-space: nowrap; }
    .filter-bar input[type="text"] {
      flex: 1; min-width: 200px; padding: 7px 12px; border: 1px solid rgba(0,0,255,0.18);
      border-radius: 7px; font-size: 0.85em; outline: none; background: #fff;
    }
    .filter-bar input[type="text"]:focus { border-color: #0056b3; box-shadow: 0 0 0 2px rgba(0,86,179,0.1); }
    .filter-bar select {
      padding: 7px 10px; border: 1px solid rgba(0,0,255,0.18);
      border-radius: 7px; font-size: 0.82em; background: #fff; outline: none; min-width: 140px;
    }
    .filter-bar select:focus { border-color: #0056b3; }
    .filter-bar .stats-text { font-size: 0.78em; color: #888; white-space: nowrap; margin-left: auto; }
    .filter-bar .stats-text b { color: #0056b3; }

    /* Category group */
    .cat-group { margin-bottom: 14px; }
    .cat-group-header {
      display: flex; align-items: center; gap: 10px; padding: 10px 14px;
      background: rgba(255,255,255,0.85); border: 1px solid rgba(0,0,255,0.1); border-radius: 10px;
      cursor: pointer; user-select: none; transition: all 0.2s;
      backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
    }
    .cat-group-header:hover { background: rgba(255,255,255,0.95); border-color: rgba(0,0,255,0.2); box-shadow: 0 2px 10px rgba(0,0,0,0.06); }
    .cat-dot { width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0; }
    .cat-group-header .cat-title { font-size: 0.9em; font-weight: 700; color: #333; }
    .cat-group-header .cat-count { font-size: 0.75em; color: #888; margin-left: auto; }
    .cat-group-header .cat-chv { color: #0056b3; font-size: 0.65em; transition: transform 0.25s; margin-left: 6px; }
    .cat-group.collapsed .cat-chv { transform: rotate(180deg); }
    .cat-group.collapsed .cat-cards { display: none; }

    /* Entry cards grid */
    .cat-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 10px; padding: 10px 0 0 0; }

    .entry-card {
      display: flex; align-items: stretch; background: #fff; border: 1px solid rgba(0,0,255,0.1);
      border-radius: 10px; overflow: hidden; cursor: pointer; transition: all 0.2s;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    }
    .entry-card:hover { border-color: rgba(0,86,179,0.3); box-shadow: 0 4px 16px rgba(0,0,0,0.08); transform: translateY(-1px); }
    .entry-card .card-bar { width: 5px; flex-shrink: 0; }
    .entry-card .card-body { padding: 10px 14px; flex: 1; min-width: 0; }
    .entry-card .card-name { font-size: 0.88em; font-weight: 700; color: #222; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .entry-card .card-type { font-size: 0.74em; color: #888; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-top: 1px; }
    .entry-card .card-meta { display: flex; gap: 10px; margin-top: 4px; font-size: 0.72em; color: #aaa; }
    .entry-card .card-meta i { color: #0056b3; }
    .entry-card .card-meta .conns { color: #0056b3; font-weight: 600; }

    /* Loading overlay */
    .ld-overlay { position: fixed; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 12px; background: rgba(255,255,255,0.85); backdrop-filter: blur(4px); z-index: 100; transition: opacity 0.5s; }
    .ld-overlay.off { opacity: 0; pointer-events: none; }
    .ld-spinner { width: 38px; height: 38px; border: 3px solid rgba(0,0,255,0.1); border-top-color: #0056b3; border-radius: 50%; animation: spin 0.75s linear infinite; }
    .ld-text { color: #0056b3; font-size: 0.82em; font-weight: 600; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* No results */
    .no-results { text-align: center; padding: 40px 20px; color: #888; font-size: 0.95em; }
    .no-results i { font-size: 2em; color: #ccc; display: block; margin-bottom: 10px; }

    @media (max-width: 600px) {
      .filter-bar { flex-direction: column; gap: 8px; }
      .filter-bar input[type="text"] { min-width: unset; }
      .cat-cards { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <nav id="navbar"></nav>

  <div class="ld-overlay" id="loading">
    <div class="ld-spinner"></div>
    <div class="ld-text" id="ld-text">Loading database...</div>
  </div>

  <div class="main">
    <div class="header-panel">
      <h1><i class="fa-solid fa-database"></i> Database Explorer</h1>
      <p class="subtitle" id="page-subtitle">Browse all entries — click any to explore its network tree</p>
    </div>

    <div class="filter-bar">
      <label><i class="fa-solid fa-search"></i></label>
      <input type="text" id="f-search" placeholder="Search entries..." />
      <select id="f-country"><option value="">All Countries</option></select>
      <select id="f-cat"><option value="">All Categories</option></select>
      <span class="stats-text" id="stats"><b>0</b> entries</span>
    </div>

    <div id="results"></div>
  </div>

  <script src="app.js"></script>
  <script>
  /* =================================================================
   *  Database Explorer — Card-based directory of all entries
   *  Grouped by category, filterable, searchable
   *  Click any entry → opens interactive tree explorer
   * ================================================================= */
  initPage('jewish');

  // ─── Color map ───────────────────────────────────────
  const CC = {
    'Entertainment & Media':'#e74c3c','Religion & Synagogues':'#9b59b6',
    'Culture & Arts':'#e67e22','Technology':'#2ecc71',
    'Community & Social Organizations':'#3498db','Education & Academia':'#1abc9c',
    'Education':'#1abc9c',
    'Representative & Umbrella Bodies':'#f39c12','Heritage & Memorials':'#8e44ad',
    'Charity & Philanthropy':'#e91e63','Investment & Private Equity':'#00bcd4',
    'Real Estate & Property':'#795548','Sports':'#ff5722',
    'Advocacy & Public Affairs':'#607d8b','Healthcare & Pharmaceuticals':'#4caf50',
    'Banking & Financial Services':'#ff9800','Research & Think Tanks':'#673ab7',
    'Retail & E-Commerce':'#009688','Defense & Security':'#f44336',
    'Food & Beverage':'#8bc34a','Conglomerates & Holding Companies':'#9e9e9e',
    'Government & Diplomacy':'#3f51b5','Fashion & Consumer Goods':'#ff4081',
    'Manufacturing & Industry':'#757575','Law Firms':'#455a64',
    'Notable Individuals':'#ffc107','Transportation':'#00acc1',
    'Advertising & PR':'#d81b60','Telecommunications':'#7c4dff',
    'Utilities & Energy':'#66bb6a','People':'#ffab40','Controversy':'#d32f2f',
    'Advocacy & Political Organizations':'#607d8b','Corporate':'#78909c',
    'Energy':'#66bb6a','Finance':'#ff9800','Government':'#3f51b5',
    'Intelligence':'#f44336','Legal':'#455a64','Media':'#e74c3c',
    'Non-Profit':'#4caf50','Philanthropy':'#e91e63','Philanthropy & Foundations':'#e91e63',
    'Political':'#f44336','Retail & Consumer Goods':'#009688','Fashion & Luxury':'#ff4081',
    'Conglomerates':'#9e9e9e'
  };
  const DC = '#546e7a';

  let allEntries = [];  // cached entry list
  let connCounts = {};  // entry id → connection count

  // ─── Load data ───────────────────────────────────────
  let dropdownsReady = 0;
  function tryLoad() { dropdownsReady++; if (dropdownsReady >= 2) loadData(); }

  fetch('/api/jewish/categories').then(r => r.json()).then(cats => {
    const sel = document.getElementById('f-cat');
    cats.sort().forEach(c => { const o = document.createElement('option'); o.value = c; o.textContent = c; sel.appendChild(o); });
    tryLoad();
  }).catch(() => tryLoad());

  fetch('/api/countries').then(r => r.json()).then(countries => {
    const sel = document.getElementById('f-country');
    countries.sort().forEach(c => { const o = document.createElement('option'); o.value = c; o.textContent = c; sel.appendChild(o); });
    tryLoad();
  }).catch(() => tryLoad());

  async function loadData() {
    document.getElementById('loading').classList.remove('off');
    document.getElementById('ld-text').textContent = 'Loading all entries...';

    try {
      const res = await fetch('/api/graph?people=0');
      const data = await res.json();

      // Count connections per entry
      connCounts = {};
      data.links.forEach(l => {
        connCounts[l.source] = (connCounts[l.source] || 0) + 1;
        connCounts[l.target] = (connCounts[l.target] || 0) + 1;
      });

      // Store entries
      allEntries = data.nodes.filter(n => n.nodeType !== 'person').map(n => ({
        id: n.id,
        name: n.name,
        country: n.country || '',
        category: n.category || 'Other',
        type: n.type || '',
        conns: connCounts[n.id] || 0
      }));

      allEntries.sort((a, b) => a.name.localeCompare(b.name));

      setSEO({ title: 'Database Explorer - Juice Project', description: allEntries.length + ' entries in the database.' });
      renderResults();
      document.getElementById('loading').classList.add('off');

    } catch (err) {
      console.error('Load error:', err);
      document.getElementById('ld-text').textContent = 'Error loading data: ' + err.message;
    }
  }

  // ─── Render results ──────────────────────────────────
  function renderResults() {
    const q = document.getElementById('f-search').value.trim().toLowerCase();
    const fc = document.getElementById('f-country').value;
    const fcat = document.getElementById('f-cat').value;

    // Filter
    let filtered = allEntries;
    if (q) filtered = filtered.filter(e => e.name.toLowerCase().indexOf(q) !== -1 || e.type.toLowerCase().indexOf(q) !== -1);
    if (fc) filtered = filtered.filter(e => e.country === fc);
    if (fcat) filtered = filtered.filter(e => e.category === fcat);

    // Stats
    document.getElementById('stats').innerHTML = '<b>' + filtered.length + '</b> of <b>' + allEntries.length + '</b> entries';
    document.getElementById('page-subtitle').textContent = filtered.length + ' entries shown — click any to explore its network tree';

    const container = document.getElementById('results');
    container.innerHTML = '';

    if (filtered.length === 0) {
      container.innerHTML = '<div class="no-results"><i class="fa-solid fa-search"></i>No entries match your filters</div>';
      return;
    }

    // Group by category
    const groups = {};
    filtered.forEach(e => {
      if (!groups[e.category]) groups[e.category] = [];
      groups[e.category].push(e);
    });

    const sortedCats = Object.keys(groups).sort();

    sortedCats.forEach(cat => {
      const entries = groups[cat];
      const group = document.createElement('div');
      group.className = 'cat-group';

      // Header
      const header = document.createElement('div');
      header.className = 'cat-group-header';
      header.innerHTML =
        '<div class="cat-dot" style="background:' + (CC[cat] || DC) + '"></div>'
        + '<span class="cat-title">' + cat + '</span>'
        + '<span class="cat-count">' + entries.length + ' entries</span>'
        + '<span class="cat-chv"><i class="fa-solid fa-chevron-up"></i></span>';

      header.onclick = () => group.classList.toggle('collapsed');
      group.appendChild(header);

      // Cards grid
      const grid = document.createElement('div');
      grid.className = 'cat-cards';

      entries.forEach(entry => {
        const card = document.createElement('div');
        card.className = 'entry-card';
        card.onclick = () => {
          window.location.href = 'network.html?id=' + encodeURIComponent(entry.id);
        };

        card.innerHTML =
          '<div class="card-bar" style="background:' + (CC[cat] || DC) + '"></div>'
          + '<div class="card-body">'
          + '<div class="card-name" title="' + entry.name.replace(/"/g, '&quot;') + '">' + entry.name + '</div>'
          + '<div class="card-type">' + (entry.type || cat) + '</div>'
          + '<div class="card-meta">'
          + '<span><i class="fa-solid fa-globe"></i> ' + (entry.country || 'N/A') + '</span>'
          + '<span class="conns"><i class="fa-solid fa-link"></i> ' + entry.conns + ' connections</span>'
          + '</div></div>';

        grid.appendChild(card);
      });

      group.appendChild(grid);
      container.appendChild(group);
    });
  }

  // ─── Filter bindings ─────────────────────────────────
  let searchTimeout;
  document.getElementById('f-search').oninput = function() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(renderResults, 200);
  };
  document.getElementById('f-country').onchange = renderResults;
  document.getElementById('f-cat').onchange = renderResults;
  </script>
</body>
</html>
